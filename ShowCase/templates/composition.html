{% extends "base.html" %}
{% block html_attr_block %}ng-app="CompositionApp"{% endblock %}

{% block title_block %}
	<title>{{composition.title | title}} by {{composition.artist.name | title}} | Interpretations and Stories</title>
{%endblock%}

{% block meta_block %}
	<meta charset="UTF-8">
	<meta name="Description" content="Title: {{composition.title}}, Artist: {{composition.artist.name}}, Category: Art Interpretations and Stories">
	<link rel="canonical" href="http://thirddime.com/arts/{{composition.slug}}" />
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />

	<meta property="og:title" content="{{composition.title | title}}">
	<meta property="og:site_name" content="ThirdDime">
	<meta property="og:url" content="http://thirddime.com/arts/{{composition.slug}}">
	<meta property="og:description" content="by {{composition.artist.name}}">
	<meta property="og:image" content="http://thirddime.com{{composition.matter.url}}">
	<meta property="og:type" content="article">
    <meta property="fb:app_id" content="462422103909005">
    <meta property="article:author" content="http://thirddime.com/@{{ composition.artist.slug }}" />
    <meta property="article:publisher" content="https://www.facebook.com/thirddimeart" />

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@thirddime">
    <meta name="twitter:title" content="{{composition.title | title}}">
    <meta name="twitter:description" content="by {{composition.artist.name}}">
    <meta name="twitter:image" content="http://thirddime.com{{composition.matter.url}}">
{%endblock%}

{% block css_block %}
	 <!-- build:css /static/build/composition.css -->
	<link rel="stylesheet" type="text/css" href="/static/css/composition/main.css">
	<!-- endbuild -->
    <script type="text/javascript">
        function paintingLoaded(painting){
            imgLoaded(painting);
            var actions = document.querySelector('.art-actions');

            var bounds = painting.getBoundingClientRect();
            console.log(bounds);
            actions.style.left = bounds.left + bounds.width + 'px';
            actions.style.top = bounds.top + 112 + 'px';
        };
    </script>
{%endblock%}

{% block body_attr_block %}ng-controller="compositionController" ng-init="init({{composition.id}}, '{{composition.matter_url}}', '{{composition.get_550_url}}', '{{composition.slug}}', '{{composition.title | escapejs}}', '{{composition.artist.name | escapejs}}', '{{composition.artist.id}}', '{{is_bookmarked}}', '{{is_admired}}', '{{composition.major}}', '{{composition.uploader.id}}', '{{is_uploader_followed}}', '{{is_uploader_me}}')"{% endblock %}

{% block content_block %}
	<section class="painting-area">

		<div class="painting-container">
            {% if is_nsfw %}
            <div ng-click="hideNsfw = true" ng-hide="hideNsfw" class="nsfw-overlay">
                <h3>This work has been marked not safe</h3>
                <h4>Click anywhere to show the work</h4>
            </div>
            {% endif %}
			<img class="painting painting-original" fit-image src="{{composition.matter_url}}" alt="{{composition.slug}}"  onload="paintingLoaded(this)">
		</div>

        <section class="art-actions" ng-cloak>
            <button class="art-action" ng-click="handleAdmire()" ng-cloak ng-hide="composition.is_admired">
                <i class="material-icons">favorite_border</i>
            </button>
            <button class="art-action" ng-click="handleAdmire()" ng-cloak ng-show="composition.is_admired">
                <i class="material-icons">favorite</i>
            </button>
            <button class="art-action" ng-click="showShare()">
                <i class="material-icons">share</i>
            </button>
            <button class="art-action" ng-click="handleBookMark()" ng-cloak ng-hide="composition.is_bookMarked">
                <i class="material-icons">bookmark_border</i>
            </button>
            <button class="art-action" ng-click="handleBookMark()" ng-cloak ng-show="composition.is_bookMarked">
                <i class="material-icons">bookmark</i>
            </button>
            <section tools-drawer class="zoom-tools">
               <button class="drawer-control" pan-zoom>
                 <i class="material-icons">search</i>
               </button>
               <button>
                 <i class="material-icons zoom-in">zoom_in</i>
               </button>
               <button>
                 <i class="material-icons zoom-reset">youtube_searched_for</i>
               </button>
               <button>
                 <i class="material-icons zoom-out">zoom_out</i>
               </button>
            </section>
        </section>

	</section>

    <section class="painting-details" >
        <div class="painting-details-container clearfix">

            <h2>{{ composition.title | title }}</h2>

            <section class="painting-parent">
                <span class="by-header"> By</span> <a class="by-user" ng-href="/@{{composition.artist.slug}}">
                    {{composition.artist.name | title}}
                </a>
            </section> 


            <section class="painting-actions" ng-cloak ng-show="'{{has_ownership}}' === 'True'">
                <i class="material-icons"  ng-click="showEditArt()">edit</i>
                <i class="material-icons" ng-click="deleteArt()">delete</i>
            </section>
            <br>

            <section class="painting-finder">
                <div class="by-header">Contributed By</div> <br>
                <section class="by-user" class="uploader">
                    <a ng-href="/@{{composition.uploader.slug}}"><img src="{{composition.uploader.picture.url}}" class="finder-picture" /></a>
                    <section class="finder-details">
                        <a ng-href="/@{{composition.uploader.slug}}"><h3 class="finder-name">{{composition.uploader.name | title}}</h3></a>
                        <a ng-href="/@{{composition.uploader.slug}}"><h4 class="finder-about">{{composition.uploader.about | title}}</h4></a>
                        <button class="finder-follow" ng-click="handleFollow($event)" ng-cloak ng-show="!composition.uploader.is_me && !composition.uploader.is_followed">Follow</button>
                        <button class="finder-follow active" ng-click="handleFollow($event)" ng-cloak ng-show="!composition.uploader.is_me && composition.uploader.is_followed">Following</button>
                    </section>
                </section>
                    
            </section>

            <section class="details-actions-details" ng-show="{{composition.buckets_count}} > 0 || {{composition.admirers_count}} >0">
                <!-- <h4 class="inactive" ng-show="{{composition.bookmarks_count}} > 0">Bookmarks {{composition.bookmarks_count}}</h4> -->
                <h4 ui-sref="buckets({compositionSlug: '{{composition.slug}}' })" ng-show="{{composition.buckets_count}} > 0">Present in  {{composition.buckets_count}} series</h4>
                <h4 ng-click="showAdmirers()" ng-show="{{composition.admirers_count}} > 0">Admired by {{composition.admirers_count}} <span ng-cloak ng-show="{{composition.admirers_count}} == 1">person</span><span ng-cloak ng-show="{{composition.admirers_count}} > 1">people</span></h4>
            </section>

            <section class="details-actions" ng-class="{'right': {{composition.buckets_count}} > 0 || {{composition.admirers_count}} > 0}">
                <button class="action collect" ng-click="showAddToBucket($event, composition)">Add To Series</button>
            </section>

        </div>

    </section>

    <section class="art-associates">

    <section class="associate-category art-interprets" ng-cloak ng-show="artInterprets.length > 0">
            <h2>Posts inspired from this work</h2>

            <div class="art-interprets-container">
                <article class="art-interpret" ng-repeat="interpret in artInterprets">
                    <p class="art-interpret-text">[[interpret.text]]</p>
                    <a class="art-interpret-user" href="/@[[interpret.user.slug]]">- [[interpret.user.name | titlecase]]</a>
                </article>
            </div>

            <section class="associated-buckets-actions" ng-cloak ng-show="artBuckets.length > 5">
                <a ui-sref="buckets({compositionSlug: '{{composition.slug}}' })">See all<i class="material-icons">arrow_forward</i></a>
            </section>
        </section>

        <section class="associate-category art-buckets" ng-cloak ng-show="artBuckets.length > 0">
            <h2>Series explaining this work</h2>

            <div class="art-buckets-container">
                <section class="art-bucket" ng-repeat="bucket in artBuckets">
                    <div class="art-bucket-picture" ng-style="{'background-image': 'url([[bucket.picture]])'}">
                        <section class="details" ng-class="{'long-description': bucket.description.length > 50}" ui-sref="bucket({userSlug: bucket.owner.slug, bucketSlug: bucket.slug})">
                            <section class="art-bucket-details-actions">
                                <i class="material-icons" ng-click="shareBucket($event, $index)" >share</i>
                                <i class="material-icons admire-on-icon" ng-cloak ng-show="bucket.is_admired">favorite</i>
                            </section>

                            <section class="bookmark-action">
                                <i class="material-icons" ng-cloak ng-hide="bucket.is_bookmarked" ng-click="handleBookMarkBucket($event, $index)">bookmark_border</i>
                                <i class="material-icons bookmark-on-icon" ng-cloak ng-show="bucket.is_bookmarked" ng-click="handleBookMarkBucket($event, $index)">bookmark</i>
                            </section>

                            <h2>[[bucket.name | titlecase]]</h2>
                            <h3>[[bucket.description]]</h3>
                            <div class="by-user">By</div>
                            <h3>[[bucket.owner.name | titlecase ]]</h3>
                            <div class="arts-count">[[bucket.compositions_count]] Artworks</div>
                            <div class="arts-count">[[bucket.views]] Views</div>

                        </section>
                    </div>
                </section>
            </div>

            <section class="associated-buckets-actions" ng-cloak ng-show="artBuckets.length > 5">
                <a ui-sref="buckets({compositionSlug: '{{composition.slug}}' })">See all<i class="material-icons">arrow_forward</i></a>
            </section>
        </section>

        <section class="associate-category associate-works artist-works" ng-cloak ng-show="artistWorks.length > 0">
            <h2>Other works created by <a ng-href="/@{{composition.artist.slug}}">{{composition.artist.name | title}}</a></h2>

            <div class="associate-works-container">
                <section class="work" ng-repeat="work in artistWorks">
                    <div class="work-picture" ng-style="{'background-image': 'url([[work.matter_400]])'}">
                        <div class="work-nsfw-overlay" ng-cloak ng-show="work.nsfw"  ng-click="work.nsfw = false">
                            <h3>This work has been marked not safe</h3>
                            <h4>Click anywhere to show the work</h4>
                        </div>
                        <a class="work-details" ng-class="{'long-title': work.title.length> 22}" custom-href="/arts/[[work.slug]]">
                            <section class="work-inset-details-actions">
                                <i class="material-icons" ng-click="shareArt($event, work)" >share</i>
                                <i class="material-icons" ng-cloak ng-hide="work.is_admired" ng-click="handleAdmireArt($event, work)">favorite_border</i>
                                <i class="material-icons admire-on-icon" ng-cloak ng-show="work.is_admired" ng-click="handleAdmireArt($event, work)">favorite</i>
                            </section>

                            <section class="bookmark-action">
                                <i class="material-icons" ng-cloak ng-hide="work.is_bookmarked" ng-click="handleBookMarkArt($event, work)">bookmark_border</i>
                                <i class="material-icons bookmark-on-icon" ng-cloak ng-show="work.is_bookmarked" ng-click="handleBookMarkArt($event, work)">bookmark</i>
                            </section>

                            <h2>[[work.title | titlecase]]</h2>
                            <div class="by-user">By</div>
                            <h3>[[work.artist.name | titlecase ]]</h3>
                            <div class="arts-count" ng-show=" work.admirers_count > 0">[[work.admirers_count]] Admirers</div>
                            <div class="arts-count" ng-show=" work.buckets_count > 0">[[work.buckets_count]] Series</div>
                            <section class="work-details-actions">
                                <button ng-click="showAddToBucket($event, work)">Add To Series</button>
                            </section>
                        </a>
                    </div>
                </section>
            </div>

            <section class="associated-works-actions" ng-cloak ng-show="artistWorks.length > 5">
                <a ng-href="/@{{composition.artist.slug}}/originals">See all<i class="material-icons">arrow_forward</i></a>
            </section>
        </section>

        <section class="associate-category associate-works uploader-works" ng-cloak ng-show="uploaderWorks.length > 0">
            <h2>Other works added by <a ng-href="/@{{composition.uploader.slug}}">{{composition.uploader.name | title}}</a></h2>

            <div class="associate-works-container">
                <section class="work" ng-repeat="work in uploaderWorks">
                    <div class="work-picture" ng-style="{'background-image': 'url([[work.matter_400]])'}">
                        <div class="work-nsfw-overlay" ng-cloak ng-show="work.nsfw"  ng-click="work.nsfw = false">
                            <h3>This work has been marked not safe</h3>
                            <h4>Click anywhere to show the work</h4>
                        </div>
                        <a class="work-details" ng-class="{'long-title': work.title.length> 22}" custom-href="/arts/[[work.slug]]">
                            <section class="work-inset-details-actions">
                                <i class="material-icons" ng-click="shareArt($event, work)" >share</i>
                                <i class="material-icons" ng-cloak ng-hide="work.is_admired" ng-click="handleAdmireArt($event, work)">favorite_border</i>
                                <i class="material-icons admire-on-icon" ng-cloak ng-show="work.is_admired" ng-click="handleAdmireArt($event, work)">favorite</i>
                            </section>

                            <section class="bookmark-action">
                                <i class="material-icons" ng-cloak ng-hide="work.is_bookmarked" ng-click="handleBookMarkArt($event, work)">bookmark_border</i>
                                <i class="material-icons bookmark-on-icon" ng-cloak ng-show="work.is_bookmarked" ng-click="handleBookMarkArt($event, work)">bookmark</i>
                            </section>

                            <h2>[[work.title | titlecase]]</h2>
                            <div class="by-user">By</div>
                            <h3>[[work.artist.name | titlecase ]]</h3>
                            <div class="arts-count" ng-show=" work.admirers_count > 0">[[work.admirers_count]] Admirers</div>
                            <div class="arts-count" ng-show=" work.buckets_count > 0">[[work.buckets_count]] Series</div>
                            <section class="work-details-actions">
                                <button ng-click="showAddToBucket($event, work)">Add To Series</button>
                            </section>
                        </a>
                    </div>
                </section>
            </div>

            <section class="associated-works-actions" ng-cloak ng-show="uploaderWorks.length > 5">
                <a ng-href="/@{{composition.uploader.slug}}/contributions">See all<i class="material-icons">arrow_forward</i></a>
            </section>
        </section>

    </section>

    <div ui-view></div>

{% endblock %}

{% block script_block %}
	<!-- build:js /static/build/composition.js -->
	<script type="text/javascript" src="/static/vendor/fullscreen/jquery.fullscreen.js"></script>
	<script type="text/javascript" src="/static/bower_components/color-thief/dist/color-thief.min.js"></script>
	<script type="text/javascript" src="/static/bower_components/jquery.panzoom/dist/jquery.panzoom.min.js"></script>

	<script type="text/javascript" src="/static/js/composition/composition.module.js"></script>
	<script type="text/javascript" src="/static/js/composition/composition.controller.js"></script>
	<script type="text/javascript" src="/static/js/composition/sticky.directive.js"></script>

    <script type="text/javascript" src="/static/js/composition/tools/tools.module.js"></script>
    <script type="text/javascript" src="/static/js/composition/tools/colors.directive.js"></script>
    <script type="text/javascript" src="/static/js/composition/tools/viewFinder.directive.js"></script>
    <script type="text/javascript" src="/static/js/composition/tools/fullscreen.directive.js"></script>
    <script type="text/javascript" src="/static/js/composition/tools/panZoom.directive.js"></script>

    <script type="text/javascript" src="/static/js/components/editArtModal/editArtModal.module.js"></script>
    <script type="text/javascript" src="/static/js/components/editArtModal/editArtModal.service.js"></script>
    <script type="text/javascript" src="/static/js/components/editArtModal/editArtModal.controller.js"></script>
    <!-- endbuild -->
{% endblock %}